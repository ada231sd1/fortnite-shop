<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fortnite Live Shop</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #0b1220;
  color: white;
  padding: 20px;
  text-align: center;
}
h1 { margin-bottom: 10px; }
#timer { margin-bottom: 20px; font-size: 18px; }
.shop-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
}
.item {
  background: #111827;
  border-radius: 10px;
  padding: 10px;
  width: 160px;
  text-align: center;
  box-shadow: 0 0 10px #000;
}
.item img {
  width: 140px;
  border-radius: 8px;
}
.price {
  margin-top: 5px;
  font-weight: bold;
}
</style>
</head>
<body>

<h1>Fortnite Item Shop</h1>
<div id="timer">Loading timer…</div>
<div class="shop-container" id="shop">Loading items…</div>

<script>
// Fortnite API with CORS proxy (tested)
const API = "https://api.allorigins.win/raw?url=https://fortnite-api.com/v2/shop/br";

// Calculate next shop reset (midnight UTC)
function nextResetUTC() {
  const now = new Date();
  return new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1, 0, 0, 0));
}

// Countdown timer
function startTimer() {
  const timerEl = document.getElementById("timer");
  setInterval(() => {
    const diff = nextResetUTC() - new Date();
    if (diff <= 0) {
      timerEl.textContent = "Refreshing soon…";
      return;
    }
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    timerEl.textContent = `Shop refresh in ${h}h ${m}m ${s}s`;
  }, 1000);
}

// Fetch shop items
function loadShop() {
  fetch(API)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("shop");
      container.innerHTML = "";

      const entries = [...data.data.featured.entries, ...data.data.daily.entries];

      entries.forEach(entry => {
        const item = entry.items[0];
        const vb = entry.finalPrice;
        const usd = (vb * 0.005).toFixed(2);

        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <img src="${item.images.icon}" alt="${item.name}">
          <div class="price">${vb} V-Bucks ($${usd})</div>
        `;
        container.appendChild(div);
      });
    })
    .catch(err => {
      const container = document.getElementById("shop");
      container.textContent = "Failed to load shop.";
      console.error(err);
    });
}

// Initialize
startTimer();
loadShop();
</script>

</body>
</html>
